<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:fragment="detail">
        <h2 th:text="${item.model}">Model Name</h2>

        <div class="detail-section">
            <h3>Basic Information</h3>
            <table class="detail-table">
                <tr>
                    <th>Level:</th>
                    <td><span class="badge" th:text="${item.level}" th:classappend="${item.level}"></span></td>
                </tr>
                <tr>
                    <th>Type:</th>
                    <td th:text="${item.type}"></td>
                </tr>
                <tr>
                    <th>Manufacturer:</th>
                    <td th:text="${item.manufacturer}"></td>
                </tr>
                <tr>
                    <th>Description:</th>
                    <td th:text="${item.description}"></td>
                </tr>
            </table>
        </div>

        <div class="detail-section" th:if="${item.constraints != null && !item.constraints.isEmpty()}">
            <h3>Constraints (<span th:text="${item.constraints.size()}">0</span>)</h3>
            <div class="constraint-accordion">
                <div th:each="constraint, iterStat : ${item.constraints}"
                     class="constraint-accordion-item"
                     th:classappend="${iterStat.first} ? ' expanded' : ''">
                    <div class="constraint-accordion-header"
                         th:attr="data-index=${iterStat.index}"
                         onclick="toggleConstraintAccordion(this)">
                        <span class="constraint-accordion-title">
                            <span class="expand-icon" th:text="${iterStat.first} ? '▲' : '▼'">▼</span>
                            <strong th:text="${constraint.name}">Name</strong>
                            <span class="badge-sm"
                                  th:if="${T(com.lumina.catalogue.model.constraint.TextLineConstraint).isInstance(constraint)}">TEXT</span>
                            <span class="badge-sm"
                                  th:if="${T(com.lumina.catalogue.model.constraint.NumberLineConstraint).isInstance(constraint)}">NUMERIC</span>
                            <span class="badge-sm"
                                  th:if="${T(com.lumina.catalogue.model.constraint.PatternLineConstraint).isInstance(constraint)}">PATTERN</span>
                            <span class="badge-required-sm" th:if="${constraint.isRequired}">Required</span>
                        </span>
                        <span class="constraint-stage-badge" th:text="${constraint.stage}">Stage</span>
                    </div>
                    <div class="constraint-accordion-content" th:style="${iterStat.first} ? '' : 'display: none;'">
                        <table class="detail-table">
                            <tr>
                                <th>Type:</th>
                                <td>
                                    <span th:if="${T(com.lumina.catalogue.model.constraint.TextLineConstraint).isInstance(constraint)}">TEXT</span>
                                    <span th:if="${T(com.lumina.catalogue.model.constraint.NumberLineConstraint).isInstance(constraint)}">NUMERIC</span>
                                    <span th:if="${T(com.lumina.catalogue.model.constraint.PatternLineConstraint).isInstance(constraint)}">PATTERN</span>
                                </td>
                            </tr>
                            <tr>
                                <th>Stage:</th>
                                <td th:text="${constraint.stage}"></td>
                            </tr>
                            <tr th:if="${constraint.description != null && !constraint.description.isEmpty()}">
                                <th>Description:</th>
                                <td th:text="${constraint.description}"></td>
                            </tr>
                            <!-- TEXT constraint fields -->
                            <tr th:if="${T(com.lumina.catalogue.model.constraint.TextLineConstraint).isInstance(constraint) && constraint.minLength != null}">
                                <th>Min Length:</th>
                                <td th:text="${constraint.minLength}"></td>
                            </tr>
                            <tr th:if="${T(com.lumina.catalogue.model.constraint.TextLineConstraint).isInstance(constraint) && constraint.maxLength != null}">
                                <th>Max Length:</th>
                                <td th:text="${constraint.maxLength}"></td>
                            </tr>
                            <!-- NUMERIC constraint fields -->
                            <tr th:if="${T(com.lumina.catalogue.model.constraint.NumberLineConstraint).isInstance(constraint)}">
                                <th>Number Type:</th>
                                <td th:text="${constraint.numberType}"></td>
                            </tr>
                            <tr th:if="${T(com.lumina.catalogue.model.constraint.NumberLineConstraint).isInstance(constraint) && constraint.min != null}">
                                <th>Min Value:</th>
                                <td th:text="${constraint.min}"></td>
                            </tr>
                            <tr th:if="${T(com.lumina.catalogue.model.constraint.NumberLineConstraint).isInstance(constraint) && constraint.max != null}">
                                <th>Max Value:</th>
                                <td th:text="${constraint.max}"></td>
                            </tr>
                            <!-- PATTERN constraint fields -->
                            <tr th:if="${T(com.lumina.catalogue.model.constraint.PatternLineConstraint).isInstance(constraint)}">
                                <th>Pattern:</th>
                                <td><code th:text="${constraint.pattern}"></code></td>
                            </tr>
                            <tr>
                                <th>Required:</th>
                                <td th:text="${constraint.isRequired ? 'Yes' : 'No'}"></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="detail-section" th:if="${item.constraints == null || item.constraints.isEmpty()}">
            <p class="empty-state">No constraints defined for this catalogue item.</p>
        </div>

        <script>
            function toggleConstraintAccordion(header) {
                const accordion = header.closest('.constraint-accordion');
                const currentItem = header.closest('.constraint-accordion-item');
                const currentContent = currentItem.querySelector('.constraint-accordion-content');
                const currentIcon = header.querySelector('.expand-icon');
                const isExpanded = currentItem.classList.contains('expanded');

                // Collapse all items
                accordion.querySelectorAll('.constraint-accordion-item').forEach(item => {
                    item.classList.remove('expanded');
                    item.querySelector('.constraint-accordion-content').style.display = 'none';
                    item.querySelector('.expand-icon').textContent = '▼';
                });

                // If the clicked item was not expanded, expand it
                if (!isExpanded) {
                    currentItem.classList.add('expanded');
                    currentContent.style.display = 'block';
                    currentIcon.textContent = '▲';
                }
            }
        </script>
    </div>
</body>
</html>
